# Test Design: Story 1.1 - Infrastructure Setup & Logging

Date: 2026-01-19
Designer: Quinn (Test Architect)

## Test Strategy Overview

- **Total test scenarios:** 8
- **Unit tests:** 5 (62.5%)
- **Integration tests:** 2 (25%)
- **E2E tests:** 1 (12.5%)
- **Priority distribution:** P0: 4, P1: 3, P2: 1

## Test Scenarios by Acceptance Criteria

### AC1: `stage.sh` exists and is executable in `misc/obsidian/infrastructure/scripts/`

#### Scenarios

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-INT-001 | Integration | P0 | Script is executable and runs | Verifies the artifact is in place and has correct permissions (+x). |

### AC2: Script checks for `jq` presence in `$PATH` and exits with an error message if missing.

#### Scenarios

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-UNIT-001 | Unit | P0 | `check_dependencies` exits 1 if `jq` missing | Critical dependency check. Mock path to remove `jq`. |
| 1.1-UNIT-002 | Unit | P0 | `check_dependencies` passes if `jq` present | Normal operation check. |

### AC3: Script implements a logging function that appends formatted entries to `99-SYSTEM/logs/staging_logs.md`.
### AC4: Log entries include a timestamp, log level (INFO/ERROR), and message.

#### Scenarios

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-UNIT-003 | Unit | P1 | `log_message` formats timestamp and level correctly | Logic verification. regex match the output. |
| 1.1-INT-002 | Integration | P1 | Logs are appended to file (file creation if missing) | Verifies file system interaction and append mode. |

### AC5: `--dry-run` flag is implemented and correctly parsed (initially sets a variable for later use).

#### Scenarios

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-UNIT-004 | Unit | P1 | Argument parser detects `--dry-run` | Logic verification. |
| 1.1-UNIT-005 | Unit | P2 | Argument parser handles mixed args | Robustness check. |

### AC6: Script is strictly POSIX `sh` compliant (no bashisms).

#### Scenarios

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-E2E-001 | E2E | P0 | Script runs without syntax error in `sh` | Compliance check. Run with `/bin/sh -n`. |

## Risk Coverage

- **Risk: `jq` missing on mobile:** Covered by `1.1-UNIT-001`.
- **Risk: Log file permission/path errors:** Covered by `1.1-INT-002`.
- **Risk: `a-shell` incompatibility:** Covered by `1.1-E2E-001` (sh strictness).

## Recommended Execution Order

1.  **P0 Unit:** 1.1-UNIT-001, 1.1-UNIT-002 (Dependency checks)
2.  **P0 Integration:** 1.1-INT-001 (Executable check)
3.  **P0 E2E:** 1.1-E2E-001 (POSIX Syntax check)
4.  **P1 tests:** 1.1-UNIT-003, 1.1-UNIT-004, 1.1-INT-002 (Logging & Args)
5.  **P2 tests:** 1.1-UNIT-005 (Edge case args)
